<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interest Calculator Pro</title>
    <link
      rel="icon"
      type="image/png"
      href="icons/android/android-launchericon-48-48.png"
    />

    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      * {
        box-sizing: border-box;
        font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      }
      :root {
        --bg: #f8fafc;
        --card: #ffffff;
        --text: #1e293b;
        --accent: #4f46e5;
        --secondary: #64748b;
        --border: #e2e8f0;
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        transition: background 0.3s;
        line-height: 1.5;
      }
      body.dark {
        --bg: #0f172a;
        --card: #1e293b;
        --text: #f1f5f9;
        --accent: #818cf8;
        --border: #334155;
      }

      .app {
        max-width: 850px;
        margin: auto;
        padding: 20px;
      }

      /* --- HEADER --- */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 1px solid var(--border);
      }
      h1 {
        font-size: 1.5rem;
        margin: 0;
      }

      .theme-toggle {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      #theme-icon {
        transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: inline-block;
      }
      .rotate-icon {
        transform: rotate(360deg) scale(1.2);
      }

      /* --- REQUIRED MARK --- */
      .required::after {
        content: " *";
        color: #ef4444; /* Red color */
        font-weight: bold;
      }

      /* --- CARD & SECTIONS --- */
      .card {
        background: var(--card);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        margin-bottom: 24px;
        border: 1px solid var(--border);
      }
      .section-header {
        margin-bottom: 20px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--bg);
      }
      .section-title {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--accent);
        font-weight: 800;
      }

      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      @media (min-width: 600px) {
        .grid-2 {
          grid-template-columns: 1fr 1fr;
        }
      }

      label {
        font-weight: 600;
        font-size: 0.85rem;
        display: block;
        margin-bottom: 6px;
        color: var(--secondary);
      }
      input,
      select {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid var(--border);
        font-size: 1rem;
        background: var(--card);
        color: var(--text);
        outline: none;
        transition: all 0.2s;
      }
      input:focus {
        border-color: var(--accent);
      }

      /* --- BUTTONS --- */
      .row-presets {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 10px;
      }
      .row-presets button {
        flex: 1;
        min-width: 80px;
        background: var(--bg);
        color: var(--secondary);
        font-size: 0.8rem;
        font-weight: 700;
        border: 1px solid var(--border);
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
      }
      .row-presets button.active {
        background: var(--accent);
        color: white;
        border-color: var(--accent);
      }

      .calculate-btn {
        width: 100%;
        background: var(--accent);
        color: #fff;
        border: none;
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        padding: 16px;
        border-radius: 12px;
        margin-top: 20px;
        box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4);
        transition: all 0.3s ease;
      }
      .calculate-btn:disabled {
        background-color: #cbd5e1;
        box-shadow: none;
        cursor: not-allowed;
        opacity: 0.6;
      }

      /* --- RESULTS --- */
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
      }
      .result-box {
        background: var(--bg);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border: 1px solid var(--border);
      }
      .result-box.highlight {
        background: var(--accent);
        color: white;
        border: none;
      }
      .value {
        font-size: 1.5rem;
        font-weight: 800;
        margin-top: 5px;
      }

      .table-container {
        overflow-x: auto;
        margin-top: 15px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 500px;
      }
      th,
      td {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        text-align: right;
      }
      th {
        background: var(--bg);
        font-size: 0.75rem;
        color: var(--secondary);
        text-transform: uppercase;
      }
    </style>
  </head>

  <body>
    <div class="app">
      <header>
        <h1>ðŸ“ˆ Interest Pro</h1>
        <button class="theme-toggle" onclick="toggleTheme()">
          <span id="theme-icon">ðŸŒ™</span> <span id="theme-text">Dark Mode</span>
        </button>
      </header>

      <div class="card">
        <div class="section-header">
          <span class="section-title">1. Duration</span>
        </div>
        <div class="grid grid-2">
          <div>
            <label class="required">Start Date</label
            ><input type="date" id="startDate" />
          </div>
          <div>
            <label class="required">End Date</label
            ><input type="date" id="endDate" />
          </div>
        </div>
        <div class="row-presets" id="yearPresets">
          <button onclick="setYears(1, this)">1 Year</button>
          <button onclick="setYears(3, this)">3 Years</button>
          <button onclick="setYears(5, this)">5 Years</button>
          <button onclick="setYears(10, this)">10 Years</button>
        </div>
        <div style="margin-top: 15px">
          <label>Or Enter Months (optional)</label>
          <input
            type="number"
            id="monthsInput"
            placeholder="Calculated from dates"
          />
        </div>
      </div>

      <div class="card">
        <div class="section-header">
          <span class="section-title">2. Financial Settings</span>
        </div>
        <div class="grid">
          <div>
            <label class="required">Principal Amount (â‚¹)</label>
            <input
              type="number"
              id="principal"
              step="0.01"
              placeholder="0.00"
            />
          </div>
          <div class="grid grid-2">
            <div>
              <label class="required">Interest Logic</label>
              <select id="logicType">
                <option value="simple">Simple Interest</option>
                <option value="compound">Yearly Compound</option>
              </select>
            </div>
            <div>
              <label class="required">Interest Type</label>
              <select id="interestType">
                <option value="flat">â‚¹ per month</option>
                <option value="per100">â‚¹ per month per 100</option>
                <option value="percent">% per month</option>
              </select>
            </div>
          </div>
          <div>
            <label class="required">Interest Value / Rate</label>
            <input type="number" id="rate" step="0.01" placeholder="e.g. 2.0" />
          </div>
        </div>
        <button
          id="calcBtn"
          class="calculate-btn"
          onclick="calculate()"
          disabled
        >
          CALCULATE
        </button>
      </div>

      <div id="outputWrapper"><div id="output"></div></div>
    </div>

    <script>
      const formatINR = (n) =>
        n.toLocaleString("en-IN", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        });
      document.getElementById("startDate").valueAsDate = new Date();

      // Theme Toggle Logic
      function toggleTheme() {
        const body = document.body;
        const icon = document.getElementById("theme-icon");
        const text = document.getElementById("theme-text");

        body.classList.toggle("dark");
        icon.classList.add("rotate-icon");
        setTimeout(() => icon.classList.remove("rotate-icon"), 500);

        const isDark = body.classList.contains("dark");
        icon.innerText = isDark ? "ðŸŒž" : "ðŸŒ™";
        text.innerText = isDark ? "Light Mode" : "Dark Mode";
        localStorage.theme = isDark ? "dark" : "light";
      }
      if (localStorage.theme === "dark") toggleTheme();

      // Validation Logic
      function validateForm() {
        const p = document.getElementById("principal").value;
        const r = document.getElementById("rate").value;
        const s = document.getElementById("startDate").value;
        const e = document.getElementById("endDate").value;
        const m = document.getElementById("monthsInput").value;
        const btn = document.getElementById("calcBtn");

        const hasPrincipal = p && parseFloat(p) > 0;
        const hasRate = r && parseFloat(r) >= 0;
        const hasTime = m || (s && e);

        btn.disabled = !(hasPrincipal && hasRate && hasTime);
      }

      ["principal", "rate", "startDate", "endDate", "monthsInput"].forEach(
        (id) => {
          document.getElementById(id).addEventListener("input", validateForm);
        }
      );

      function setYears(y, btn) {
        document
          .querySelectorAll("#yearPresets button")
          .forEach((b) => b.classList.remove("active"));
        if (btn) btn.classList.add("active");
        const s = new Date();
        const e = new Date();
        e.setFullYear(s.getFullYear() + y);
        document.getElementById("startDate").value = s
          .toISOString()
          .split("T")[0];
        document.getElementById("endDate").value = e
          .toISOString()
          .split("T")[0];
        document.getElementById("monthsInput").value = y * 12;
        validateForm();
      }

      function getMonths() {
        const m = parseFloat(document.getElementById("monthsInput").value);
        if (m > 0) return m;
        const s = new Date(document.getElementById("startDate").value);
        const e = new Date(document.getElementById("endDate").value);
        return (e - s) / (1000 * 60 * 60 * 24) / 30;
      }

      function monthlyInterest(p) {
        const r = parseFloat(document.getElementById("rate").value);
        const type = document.getElementById("interestType").value;
        if (type === "flat") return r;
        if (type === "percent") return (p * r) / 100;
        return (p / 100) * r;
      }

      // Business Logic
      function calculate() {
        let p = parseFloat(document.getElementById("principal").value);
        let months = getMonths();
        const logic = document.getElementById("logicType").value;
        if (p <= 0 || months <= 0) return alert("Invalid Input");

        let full = Math.floor(months),
          frac = months - full;
        let totalInt = 0,
          yearInt = 0,
          yearStart = p;
        let mRows = "",
          yRows = "",
          labels = ["Start"],
          chartData = [p];
        let month = 1,
          year = 1;

        for (let i = 1; i <= full; i++) {
          let mi = monthlyInterest(p);
          yearInt += mi;
          totalInt += mi;
          mRows += `<tr><td>${month}</td><td>${formatINR(
            p
          )}</td><td>${formatINR(mi)}</td><td>${formatINR(totalInt)}</td></tr>`;

          if (i % 12 === 0) {
            if (logic === "compound") p += yearInt;
            labels.push("Y" + year);
            chartData.push(p + (logic === "simple" ? totalInt : 0));
            yRows += `<tr><td>${year}</td><td>${formatINR(
              yearStart
            )}</td><td>${formatINR(yearInt)}</td><td>${formatINR(
              p + (logic === "simple" ? totalInt : 0)
            )}</td></tr>`;
            year++;
            yearStart = p;
            yearInt = 0;
          }
          month++;
        }

        if (frac > 0) {
          let mi = monthlyInterest(p) * frac;
          totalInt += mi;
          yearInt += mi;
          mRows += `<tr><td>${month}*</td><td>${formatINR(
            p
          )}</td><td>${formatINR(mi)}</td><td>${formatINR(totalInt)}</td></tr>`;
        }

        if (yearInt > 0) {
          const finalP = logic === "compound" ? p + yearInt : p;
          yRows += `<tr><td>${year}*</td><td>${formatINR(
            yearStart
          )}</td><td>${formatINR(yearInt)}</td><td>${formatINR(
            finalP + (logic === "simple" ? totalInt : 0)
          )}</td></tr>`;
          p = finalP;
          labels.push("Final");
          chartData.push(p + (logic === "simple" ? totalInt : 0));
        }

        window.shareData = {
          p: p + (logic === "simple" ? totalInt : 0),
          totalInt,
          months,
        };

        document.getElementById("output").innerHTML = `
        <div class="card summary-grid">
            <div class="result-box"><span>Principal</span><div class="value">â‚¹${formatINR(
              parseFloat(document.getElementById("principal").value)
            )}</div></div>
            <div class="result-box"><span>Interest Earned</span><div class="value">â‚¹${formatINR(
              totalInt
            )}</div></div>
            <div class="result-box highlight"><span>Total Amount</span><div class="value">â‚¹${formatINR(
              window.shareData.p
            )}</div></div>
        </div>
        <div class="card"><canvas id="growthChart"></canvas></div>
        <div class="grid grid-2" style="margin-bottom:20px">
            <button class="theme-toggle" style="justify-content:center" onclick="copyText()">ðŸ“‹ Copy Summary</button>
            <button class="theme-toggle" style="justify-content:center" onclick="downloadImage()">ðŸ“¸ Screenshot</button>
        </div>
        <div class="card"><h3>ðŸ“† Yearly Breakdown</h3><div class="table-container"><table><tr><th>Year</th><th>Start</th><th>Interest</th><th>End</th></tr>${yRows}</table></div></div>
        <div class="card"><h3>ðŸ“… Monthly History</h3><div class="table-container"><table><tr><th>Month</th><th>Principal</th><th>Interest</th><th>Acc. Interest</th></tr>${mRows}</table></div></div>
    `;

        drawChart(labels, chartData);
        document
          .getElementById("output")
          .scrollIntoView({ behavior: "smooth" });
      }

    
      function drawChart(labels, data) {
        new Chart(document.getElementById("growthChart"), {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "Value",
                data: data, // Use the 'data' parameter passed into the function
                borderColor: "#4f46e5",
                fill: true,
                tension: 0.4,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
          },
        });
      }
      function copyText() {
        const t = window.shareData;
        navigator.clipboard.writeText(
          `Interest Summary\nPrincipal: â‚¹${formatINR(
            parseFloat(document.getElementById("principal").value)
          )}\nInterest: â‚¹${formatINR(t.totalInt)}\nTotal: â‚¹${formatINR(
            t.p
          )}\nDuration: ${t.months.toFixed(2)} months`
        );
        alert("Copied âœ…");
      }

      function downloadImage() {
        html2canvas(document.getElementById("outputWrapper"), {
          scale: 2,
          backgroundColor:
            localStorage.theme === "dark" ? "#0f172a" : "#f8fafc",
        }).then((c) => {
          let a = document.createElement("a");
          a.href = c.toDataURL();
          a.download = "interest.png";
          a.click();
        });
      }
    </script>
  </body>
</html>
